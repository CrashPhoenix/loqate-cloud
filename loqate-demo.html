<!-- Import Polymer -->
<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/polymer-jsonp/polymer-jsonp.html">
<link rel="import" href="bower_components/core-input/core-input.html">
<polymer-element name="loqate-demo" attributes="lqtkey inputAddress process result status">
  <template>
    <input is="core-input" committedValue="{{input}}">

    <polymer-jsonp
      id="ajax"
      handleAs="json"
      response="{{results}}"
      on-polymer-response="{{handleResponse}}">
    </polymer-jsonp>
  </template>
  <script>
    Polymer('loqate-demo', {
      lqtkey: null,
      inputAddress: null,
      process: 'v',
      ready: function() {
        this.$.ajax.url = "https://saas.loqate.com/rest/?";
        if (this.lqtkey)
          this.$.ajax.url += "lqtkey=" + this.lqtkey + "&";
        if (this.inputAddress)
          this.$.ajax.url += "addr=" + this.inputAddress + "&";
        this.$.ajax.url += ("p=" + this.process + "&callback=");
        this.$.ajax.go();
      },
      handleResponse: function(){
        /*console.log(this.results);*/
        this.status = this.results.status;
        currentResults = this.results.results[0];
        console.log(currentResults);
        var avc = currentResults["AVC"];
        if (avc.indexOf("V4") >= 0 || avc.indexOf("V5") >= 0)
          this.result = currentResults["Address1"] + " " + currentResults["Address2"];
      }
    });
  </script>
</polymer-element>

